# è´¹æ›¼å­¦ä¹ å¹³å° - ç¨‹åºè®¾è®¡æ–‡æ¡£

## ğŸ“‹ ç›®å½•
1. [é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
2. [ç³»ç»Ÿæ¶æ„](#2-ç³»ç»Ÿæ¶æ„)
3. [æŠ€æœ¯æ ˆ](#3-æŠ€æœ¯æ ˆ)
4. [æ•°æ®æ¨¡å‹](#4-æ•°æ®æ¨¡å‹)
5. [APIè®¾è®¡](#5-apiè®¾è®¡)
6. [å‰ç«¯æ¶æ„](#6-å‰ç«¯æ¶æ„)
7. [æ ¸å¿ƒåŠŸèƒ½å®ç°](#7-æ ¸å¿ƒåŠŸèƒ½å®ç°)
8. [å®‰å…¨æœºåˆ¶](#8-å®‰å…¨æœºåˆ¶)
9. [éƒ¨ç½²ä¸é…ç½®](#9-éƒ¨ç½²ä¸é…ç½®)
10. [æœªæ¥ä¼˜åŒ–æ–¹å‘](#10-æœªæ¥ä¼˜åŒ–æ–¹å‘)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®å®šä½
è´¹æ›¼å­¦ä¹ å¹³å°æ˜¯åŸºäº**è´¹æ›¼å­¦ä¹ æ³•**çš„æ™ºèƒ½å­¦ä¹ è¾…åŠ©ç³»ç»Ÿï¼Œé€šè¿‡"ä»¥æ•™ä¿ƒå­¦"å¸®åŠ©ç”¨æˆ·æ·±åŒ–çŸ¥è¯†ç†è§£ã€‚

### 1.2 æ ¸å¿ƒä»·å€¼é“¾
```
è¾“å…¥çŸ¥è¯†ç‚¹ â†’ è¯­éŸ³å¤è¿° â†’ AIè¯„ä¼° â†’ ç²¾å‡†åé¦ˆ â†’ æŒæ¡çŸ¥è¯†
```

### 1.3 æ ¸å¿ƒåŠŸèƒ½çŸ©é˜µ

| åŠŸèƒ½æ¨¡å— | åŠŸèƒ½æè¿° | ç”¨æˆ·ä»·å€¼ |
|---------|---------|---------|
| çŸ¥è¯†ç‚¹ç®¡ç† | åˆ›å»º/ç¼–è¾‘/åˆ é™¤/æµè§ˆ | æ„å»ºä¸ªäººçŸ¥è¯†åº“ |
| å¯Œæ–‡æœ¬ç¼–è¾‘ | Markdown + æ‰€è§å³æ‰€å¾— | çµæ´»å†…å®¹è¡¨è¾¾ |
| è¯­éŸ³å¤è¿° | å½•éŸ³ + AIè½¬å½• | é™ä½è¾“å…¥é—¨æ§› |
| AIæ™ºèƒ½è¯„ä¼° | æ–‡æœ¬æ¶¦è‰² + è¯„åˆ† + å»ºè®® | ç²¾å‡†å­¦ä¹ åé¦ˆ |
| å¤ä¹ ç®¡ç† | è‡ªåŠ¨æ ‡è®° + ç­›é€‰ | é—´éš”é‡å¤å­¦ä¹  |
| æ ‡é¢˜æµè§ˆ | ç½‘æ ¼å¼ + æ’åº | å¿«é€Ÿå¯¼èˆªå®šä½ |

### 1.4 å…¸å‹ç”¨æˆ·åœºæ™¯

**åœºæ™¯1: å­¦ä¹ æ–°çŸ¥è¯†**
```
ç”¨æˆ·å­¦å®Œæ¦‚å¿µ â†’ åˆ›å»ºçŸ¥è¯†ç‚¹ â†’ è¯­éŸ³å¤è¿° â†’ AIè¯„ä¼° â†’ å‘ç°ç›²åŒº â†’ ä¿®æ­£è®¤çŸ¥
```

**åœºæ™¯2: å¤ä¹ å·©å›º**
```
æ‰“å¼€å¤ä¹ åˆ—è¡¨ â†’ ç­›é€‰éœ€å¤ä¹ é¡¹ â†’ é€‰æ‹©çŸ¥è¯†ç‚¹ â†’ é‡æ–°å¤è¿° â†’ è¾¾æ ‡è§£é™¤æ ‡è®°
```

**åœºæ™¯3: çŸ¥è¯†ç®¡ç†**
```
æµè§ˆæ ‡é¢˜åˆ—è¡¨ â†’ æ—¶é—´/æ ‡é¢˜æ’åº â†’ å¿«é€Ÿå®šä½ â†’ ç¼–è¾‘/å¤è¿°
```

---

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æ€»ä½“æ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 ç”¨æˆ·å±‚ (Browser)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚             å‰ç«¯å±‚ (React + Vite)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  é¡µé¢ç»„ä»¶  â”‚  ä¸šåŠ¡ç»„ä»¶  â”‚  çŠ¶æ€ç®¡ç†  â”‚  è·¯ç”±æ§åˆ¶ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           APIå±‚ (Express REST API)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ç”¨æˆ·è®¤è¯  â”‚  çŸ¥è¯†ç‚¹   â”‚  è¯­éŸ³è½¬å½•  â”‚  AIè¯„ä¼°  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              æ•°æ®å±‚ (MongoDB)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚   User    â”‚ Knowledge â”‚  Attempt  â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              å¤–éƒ¨æœåŠ¡å±‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  ç™¾åº¦AI   â”‚  Whisper  â”‚ åƒå¸†å¤§æ¨¡å‹ â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æŠ€æœ¯é€‰å‹å†³ç­–

| å†³ç­–ç‚¹ | é€‰å‹ | æ ¸å¿ƒç†ç”± |
|-------|------|---------|
| å‰ç«¯æ¡†æ¶ | React 18 | ç»„ä»¶åŒ–/ç”Ÿæ€æˆç†Ÿ/Hooksä¼˜é›… |
| æ„å»ºå·¥å…· | Vite | å¯åŠ¨å¿«/HMR/åŸç”ŸESM |
| è·¯ç”± | React Router v7 | å£°æ˜å¼/åµŒå¥—è·¯ç”± |
| çŠ¶æ€ç®¡ç† | Context API | è½»é‡/å†…ç½®/é€‚ä¸­å‹é¡¹ç›® |
| å¯Œæ–‡æœ¬ç¼–è¾‘ | ReactQuill | æ‰€è§å³æ‰€å¾—/æ‰©å±•æ€§å¼º |
| Markdown | react-markdown | GFM/æ•°å­¦å…¬å¼/ä»£ç é«˜äº® |
| åç«¯æ¡†æ¶ | Express 5 | æˆç†Ÿç¨³å®š/ä¸­é—´ä»¶ä¸°å¯Œ |
| æ•°æ®åº“ | MongoDB | æ–‡æ¡£å‹/çµæ´»schema |
| è®¤è¯ | JWTåŒä»¤ç‰Œ | æ— çŠ¶æ€/å¯æ‰©å±• |
| è¯­éŸ³è½¬å½• | Whisper+ç™¾åº¦ | æœ¬åœ°ä¼˜å…ˆ/äº‘ç«¯é™çº§ |
| AIè¯„ä¼° | ç™¾åº¦åƒå¸† | ä¸­æ–‡ä¼˜åŒ–/æˆæœ¬å¯æ§ |

---

## 3. æŠ€æœ¯æ ˆ

### 3.1 å‰ç«¯æŠ€æœ¯æ ˆ
```javascript
// ========== æ ¸å¿ƒæ¡†æ¶ ==========
React 18.3.1                    // UIæ¡†æ¶
React Router DOM 7.9.4          // è·¯ç”±ç®¡ç†
Vite 7.1.14                     // æ„å»ºå·¥å…·

// ========== UIç»„ä»¶ ==========
ReactQuill 2.0.0                // å¯Œæ–‡æœ¬ç¼–è¾‘å™¨
react-markdown 10.1.0           // Markdownæ¸²æŸ“
quilljs-markdown 1.2.0          // Markdownå¿«æ·é”®

// ========== æ•°å­¦ä¸å›¾è¡¨ ==========
katex 0.16.25                   // LaTeXæ•°å­¦å…¬å¼
rehype-katex 7.0.1              // å…¬å¼æ¸²æŸ“æ’ä»¶
mermaid 11.12.0                 // æµç¨‹å›¾/å›¾è¡¨

// ========== è¯­éŸ³å½•åˆ¶ ==========
recordrtc 5.6.2                 // éŸ³è§†é¢‘å½•åˆ¶
Web Speech API                  // æµè§ˆå™¨åŸç”Ÿè¯­éŸ³è¯†åˆ«

// ========== ç½‘ç»œä¸å®‰å…¨ ==========
axios 1.12.2                    // HTTPå®¢æˆ·ç«¯
dompurify 3.3.0                 // XSSé˜²æŠ¤
rehype-sanitize 6.0.0           // HTMLæ¸…ç†
```

### 3.2 åç«¯æŠ€æœ¯æ ˆ
```javascript
// ========== æ ¸å¿ƒæ¡†æ¶ ==========
Express 5.1.0                   // Webæ¡†æ¶
Mongoose 8.18.2                 // MongoDB ODM
MongoDB 6.20.0                  // æ•°æ®åº“é©±åŠ¨

// ========== è®¤è¯ä¸å®‰å…¨ ==========
jsonwebtoken 9.0.2              // JWTä»¤ç‰Œ
bcryptjs 3.0.2                  // å¯†ç åŠ å¯†
cors 2.8.5                      // è·¨åŸŸæ§åˆ¶

// ========== æ–‡ä»¶å¤„ç† ==========
multer 2.0.2                    // æ–‡ä»¶ä¸Šä¼ 
fluent-ffmpeg 2.1.3             // éŸ³é¢‘è½¬æ¢
ffmpeg-static 5.2.0             // ffmpegäºŒè¿›åˆ¶

// ========== AIæœåŠ¡ ==========
baidu-aip-sdk 4.16.16           // ç™¾åº¦AI SDK
axios 1.13.2                    // HTTPå®¢æˆ·ç«¯

// ========== å·¥å…· ==========
dotenv 17.2.2                   // ç¯å¢ƒå˜é‡
nodemon 3.0.1                   // å¼€å‘çƒ­é‡è½½
```

---

## 4. æ•°æ®æ¨¡å‹

### 4.1 ç”¨æˆ·æ¨¡å‹ (User)
```javascript
{
  _id: ObjectId,                    // MongoDBè‡ªåŠ¨ç”Ÿæˆ
  username: String,                 // ç”¨æˆ·å(å”¯ä¸€)
  email: String,                    // é‚®ç®±(å”¯ä¸€)
  password: String,                 // bcryptåŠ å¯†å¯†ç 
  createdAt: Date,                  // åˆ›å»ºæ—¶é—´
  updatedAt: Date                   // æ›´æ–°æ—¶é—´
}

// ========== ç´¢å¼• ==========
{ email: 1 }        UNIQUE          // é‚®ç®±å”¯ä¸€ç´¢å¼•
{ username: 1 }     UNIQUE          // ç”¨æˆ·åå”¯ä¸€ç´¢å¼•
```

### 4.2 çŸ¥è¯†ç‚¹æ¨¡å‹ (KnowledgePoint)
```javascript
{
  _id: ObjectId,
  title: String,                    // æ ‡é¢˜(å¿…å¡«)
  content: String,                  // å†…å®¹(HTML/Markdown)
  category: String,                 // åˆ†ç±»(é»˜è®¤'general')
  tags: [String],                   // æ ‡ç­¾æ•°ç»„
  author: ObjectId,                 // ä½œè€…(å…³è”User)
  difficulty: String,               // éš¾åº¦(beginner/intermediate/advanced)
  isPublic: Boolean,                // æ˜¯å¦å…¬å¼€(é»˜è®¤true)
  views: Number,                    // æµè§ˆæ¬¡æ•°
  likes: [ObjectId],                // ç‚¹èµç”¨æˆ·åˆ—è¡¨
  reviewList: Boolean,              // éœ€å¤ä¹ æ ‡è®°(é»˜è®¤false)
  createdAt: Date,
  updatedAt: Date
}

// ========== ç´¢å¼• ==========
{ author: 1, createdAt: -1 }        // ç”¨æˆ·çŸ¥è¯†ç‚¹åˆ—è¡¨æŸ¥è¯¢
{ reviewList: 1 }                   // å¤ä¹ åˆ—è¡¨ç­›é€‰
```

### 4.3 å¤è¿°è®°å½•æ¨¡å‹ (FeynmanAttempt)
```javascript
{
  _id: ObjectId,
  knowledgePoint: ObjectId,         // å…³è”çŸ¥è¯†ç‚¹
  author: ObjectId,                 // å…³è”ç”¨æˆ·
  transcribedText: String,          // è½¬å½•æ–‡æœ¬
  score: Number,                    // AIè¯„åˆ†(0-100)
  feedback: String,                 // AIåé¦ˆ
  durationSeconds: Number,          // æ—¶é•¿(ç§’)
  durationMs: Number,               // æ—¶é•¿(æ¯«ç§’)
  createdAt: Date,
  updatedAt: Date
}

// ========== ç´¢å¼• ==========
{ knowledgePoint: 1, createdAt: -1 } // çŸ¥è¯†ç‚¹å¤è¿°å†å²
{ author: 1 }                         // ç”¨æˆ·å¤è¿°è®°å½•
```

### 4.4 å®ä½“å…³ç³»å›¾
```
User (1)
  â”‚
  â”‚ author
  â†“
KnowledgePoint (N)
  â”‚
  â”‚ knowledgePoint
  â†“
FeynmanAttempt (N)
  â”‚
  â”‚ author
  â†“
User
```

---

## 5. APIè®¾è®¡

### 5.1 è®¤è¯æ¨¡å— (Auth)

#### æ³¨å†Œæ¥å£
```http
POST /api/users/register
Content-Type: application/json

# Request
{
  "username": "testuser",
  "email": "test@example.com",
  "password": "securePassword123"
}

# Response (200 OK)
{
  "token": "eyJhbGciOiJIUzI1NiIs...",
  "refreshToken": "eyJhbGciOiJIUzI1..."
}

# Error (400)
{ "msg": "Email already exists" }
```

#### ç™»å½•æ¥å£
```http
POST /api/users/login
Content-Type: application/json

# Request
{
  "email": "test@example.com",
  "password": "securePassword123"
}

# Response (200 OK)
{
  "token": "eyJhbGciOiJIUzI1NiIs...",
  "refreshToken": "eyJhbGciOiJIUzI1..."
}
```

#### åˆ·æ–°ä»¤ç‰Œ
```http
POST /api/users/refresh
Authorization: Bearer <refreshToken>

# Response (200 OK)
{ "token": "eyJhbGciOiJIUzI1NiIs..." }

# Error (401)
{
  "msg": "Refresh token expired",
  "error": "REFRESH_EXPIRED"
}
```

### 5.2 çŸ¥è¯†ç‚¹æ¨¡å—

å®Œæ•´APIåˆ—è¡¨ï¼š
- `POST /api/knowledge-points` - åˆ›å»ºçŸ¥è¯†ç‚¹
- `GET /api/knowledge-points` - è·å–åˆ—è¡¨
- `GET /api/knowledge-points/:id` - è·å–è¯¦æƒ…
- `PUT /api/knowledge-points/:id` - æ›´æ–°çŸ¥è¯†ç‚¹
- `DELETE /api/knowledge-points/:id` - åˆ é™¤çŸ¥è¯†ç‚¹
- `PUT /api/knowledge-points/:id/review` - æ›´æ–°å¤ä¹ çŠ¶æ€

### 5.3 è¯­éŸ³è½¬å½•æ¨¡å—

- `POST /api/audio/transcribe` - ç™¾åº¦APIè½¬å½•
- `POST /api/audio/transcribe-local` - Whisperæœ¬åœ°è½¬å½•
- `GET /api/audio/whisper-status` - WhisperæœåŠ¡çŠ¶æ€
- `POST /api/audio/evaluate` - AIè¯„ä¼°å¤è¿°è´¨é‡

#### AIè¯„ä¼°ç¤ºä¾‹
```http
POST /api/audio/evaluate
Authorization: Bearer <token>
Content-Type: application/json

# Request
{
  "originalContent": "é—­åŒ…æ˜¯å‡½æ•°åŠå…¶å¼•ç”¨ç¯å¢ƒçš„ç»„åˆ...",
  "transcribedText": "é—­åŒ…å°±æ˜¯å‡½æ•°å’Œå¤–éƒ¨å˜é‡çš„ç»„åˆ..."
}

# Response (200 OK)
{
  "polishedText": "é—­åŒ…æ˜¯å‡½æ•°ä¸å…¶èƒ½è®¿é—®çš„å¤–éƒ¨å˜é‡çš„ç»„åˆ...",
  "evaluation": "å‡†ç¡®æŠŠæ¡æ ¸å¿ƒæ¦‚å¿µ,è¡¨è¾¾æ¸…æ™°",
  "strengths": [
    "å‡†ç¡®ç†è§£é—­åŒ…å®šä¹‰",
    "é€»è¾‘æ¸…æ™°è¿è´¯"
  ],
  "weaknesses": [
    "è¡¨è¾¾ç•¥æ˜¾å£è¯­åŒ–"
  ],
  "score": 88
}
```

---

## 6. å‰ç«¯æ¶æ„

### 6.1 ç›®å½•ç»“æ„
```
src/
â”œâ”€â”€ api/
â”‚   â””â”€â”€ axios.js                    # Axioså®ä¾‹(æ‹¦æˆªå™¨/è‡ªåŠ¨åˆ·æ–°)
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ KnowledgePointBrowser.jsx   # æ ‡é¢˜æµè§ˆç»„ä»¶
â”‚   â”œâ”€â”€ Layout.jsx                  # å…¨å±€å¸ƒå±€
â”‚   â”œâ”€â”€ LocalVoiceRecorder.jsx      # æµè§ˆå™¨åŸç”Ÿè¯­éŸ³è¯†åˆ«
â”‚   â”œâ”€â”€ ProtectedRoute.jsx          # è·¯ç”±å®ˆå«
â”‚   â”œâ”€â”€ VoiceRecorder.jsx           # å½•éŸ³+è½¬å½•(æœåŠ¡ç«¯)
â”‚   â””â”€â”€ VolumeVisualizer.jsx        # éŸ³é‡å¯è§†åŒ–
â”œâ”€â”€ context/
â”‚   â””â”€â”€ AuthContext.jsx             # è®¤è¯çŠ¶æ€ç®¡ç†
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ DashboardPage.jsx           # ä¸»é¡µ(è¯¦æƒ…è§†å›¾)
â”‚   â”œâ”€â”€ FeynmanRecordPage.jsx       # å¤è¿°é¡µ(å½•éŸ³+AIè¯„ä¼°)
â”‚   â”œâ”€â”€ KnowledgePointFormPage.jsx  # çŸ¥è¯†ç‚¹è¡¨å•
â”‚   â”œâ”€â”€ LoginPage.jsx               # ç™»å½•é¡µ
â”‚   â””â”€â”€ RegisterPage.jsx            # æ³¨å†Œé¡µ
â”œâ”€â”€ App.jsx                         # è·¯ç”±é…ç½®
â”œâ”€â”€ main.jsx                        # åº”ç”¨å…¥å£
â””â”€â”€ index.css                       # å…¨å±€æ ·å¼
```

### 6.2 è·¯ç”±æ¶æ„
```javascript
<Routes>
  <Route element={<Layout />}>
    {/* å…¬å…±è·¯ç”± */}
    <Route path="/login" element={<LoginPage />} />
    <Route path="/register" element={<RegisterPage />} />

    {/* å—ä¿æŠ¤è·¯ç”± */}
    <Route element={<ProtectedRoute />}>
      <Route path="/" element={<DashboardPage />} />
      <Route path="/browse" element={<KnowledgePointBrowser />} />
      <Route path="/kp/new" element={<KnowledgePointFormPage />} />
      <Route path="/kp/edit/:id" element={<KnowledgePointFormPage />} />
      <Route path="/feynman/:id" element={<FeynmanRecordPage />} />
    </Route>
  </Route>
</Routes>
```

---

## 7. æ ¸å¿ƒåŠŸèƒ½å®ç°

### 7.1 JWTåŒä»¤ç‰Œè®¤è¯

#### ä»¤ç‰Œæœºåˆ¶
```
è®¿é—®ä»¤ç‰Œ (Access Token)
â”œâ”€â”€ æœ‰æ•ˆæœŸ: 24å°æ—¶
â”œâ”€â”€ ç”¨é€”: APIè¯·æ±‚è®¤è¯
â””â”€â”€ å­˜å‚¨: localStorage + Context

åˆ·æ–°ä»¤ç‰Œ (Refresh Token)
â”œâ”€â”€ æœ‰æ•ˆæœŸ: 7å¤©
â”œâ”€â”€ ç”¨é€”: åˆ·æ–°è®¿é—®ä»¤ç‰Œ
â””â”€â”€ å­˜å‚¨: localStorage
```

#### è‡ªåŠ¨åˆ·æ–°æµç¨‹
```
1. APIè¯·æ±‚ â†’ 401 + TOKEN_EXPIRED
2. æ‹¦æˆªå™¨æ•è· â†’ POST /users/refresh
3. éªŒè¯refreshToken â†’ è¿”å›æ–°token
4. æ›´æ–°localStorage â†’ é‡è¯•åŸè¯·æ±‚
5. å¤±è´¥ â†’ æ¸…ç†token â†’ é‡å®šå‘ç™»å½•
```

### 7.2 è¯­éŸ³è½¬å½•åŒå¼•æ“

#### æ¶æ„è®¾è®¡
```
è½¬å½•ç­–ç•¥
â”œâ”€â”€ æœ¬åœ°Whisper (ä¼˜å…ˆ)
â”‚   â”œâ”€â”€ ä¼˜ç‚¹: ç¦»çº¿å¯ç”¨/å“åº”å¿«/æ— é™åˆ¶
â”‚   â”œâ”€â”€ ç¼ºç‚¹: éœ€éƒ¨ç½²/GPUä¾èµ–
â”‚   â””â”€â”€ é™çº§: è¿ç»­å¤±è´¥3æ¬¡ â†’ ç™¾åº¦API
â””â”€â”€ ç™¾åº¦API (é™çº§)
    â”œâ”€â”€ ä¼˜ç‚¹: æ— éœ€éƒ¨ç½²/ç¨³å®šå¯é 
    â””â”€â”€ ç¼ºç‚¹: ç½‘ç»œä¾èµ–/QPSé™åˆ¶
```

#### é™çº§æœºåˆ¶
```javascript
// åç«¯é™çº§é€»è¾‘
let failureCount = 0;
const MAX_FAILURES = 3;

if (whisperFailed) {
  failureCount++;
  if (failureCount >= MAX_FAILURES) {
    isDegraded = true;
    return 503; // é€šçŸ¥å‰ç«¯åˆ‡æ¢
  }
}

// å‰ç«¯è‡ªåŠ¨åˆ‡æ¢
if (status === 503 && newFailureCount >= 3) {
  setTranscriptionMethod('baidu');
  localStorage.setItem('transcriptionMethod', 'baidu');
}
```

### 7.3 AIè¯„ä¼°ç³»ç»Ÿ

#### è¯„ä¼°ç»´åº¦
```
å¤šç»´åº¦è¯„åˆ† (0-100åˆ†)
â”œâ”€â”€ å‡†ç¡®æ€§ (40%) - æ ¸å¿ƒæ¦‚å¿µæ˜¯å¦æ­£ç¡®
â”œâ”€â”€ å®Œæ•´æ€§ (30%) - å…³é”®è¦ç‚¹æ˜¯å¦é—æ¼
â”œâ”€â”€ é€»è¾‘æ€§ (20%) - è¡¨è¾¾æ˜¯å¦æ¸…æ™°è¿è´¯
â””â”€â”€ æµç•…æ€§ (10%) - è¯­è¨€æ˜¯å¦æµç•…è‡ªç„¶
```

#### è¯„åˆ†æ ‡å‡†

| åˆ†æ•° | æè¿° |
|------|------|
| 90-100 | æ ¸å¿ƒæ¦‚å¿µå®Œå…¨æ­£ç¡®,è¦ç‚¹é½å…¨,é€»è¾‘æ¸…æ™°,è¡¨è¾¾æµç•… |
| 75-89 | æ ¸å¿ƒæ¦‚å¿µæ­£ç¡®,å¤§éƒ¨åˆ†è¦ç‚¹è¦†ç›–,å°ç¼ºé™·ä¸å½±å“ |
| 60-74 | æ¦‚å¿µåŸºæœ¬æ­£ç¡®,ä½†æœ‰æ˜æ˜¾é—æ¼æˆ–é€»è¾‘ä¸æ¸… |
| 45-59 | éƒ¨åˆ†æ¦‚å¿µæ­£ç¡®,å…³é”®è¦ç‚¹é—æ¼è¾ƒå¤šæˆ–æœ‰é”™è¯¯ |
| 0-44 | æ ¸å¿ƒæ¦‚å¿µé”™è¯¯æˆ–ä¸¥é‡é—æ¼,éœ€é‡æ–°å­¦ä¹  |

#### è‡ªåŠ¨å¤ä¹ æ ‡è®°
```javascript
// è¯„ä¼°åè‡ªåŠ¨æ›´æ–°å¤ä¹ çŠ¶æ€
if (score < 60) {
  // åˆ†æ•° < 60 â†’ æ ‡è®°éœ€å¤ä¹ 
  await apiClient.put(`/knowledge-points/${id}/review`, {
    reviewList: true
  });
} else {
  // åˆ†æ•° â‰¥ 60 â†’ è§£é™¤å¤ä¹ æ ‡è®°
  await apiClient.put(`/knowledge-points/${id}/review`, {
    reviewList: false
  });
}
```

### 7.4 çŸ¥è¯†ç‚¹æµè§ˆ

#### åŒè§†å›¾è®¾è®¡
```
è¯¦æƒ…è§†å›¾ (DashboardPage)
â”œâ”€â”€ å±•ç¤º: æ ‡é¢˜ + å®Œæ•´å†…å®¹
â”œâ”€â”€ æ¸²æŸ“: Markdown/HTML + ä»£ç é«˜äº®
â””â”€â”€ é€‚ç”¨: æ·±åº¦å­¦ä¹ /å†…å®¹å›é¡¾

æ ‡é¢˜æµè§ˆ (KnowledgePointBrowser)
â”œâ”€â”€ å±•ç¤º: æ ‡é¢˜ + æ—¶é—´ + æ“ä½œ
â”œâ”€â”€ å¸ƒå±€: ç½‘æ ¼å¼Gridå¸ƒå±€
â””â”€â”€ é€‚ç”¨: å¿«é€Ÿå¯¼èˆª/æ‰¹é‡ç®¡ç†
```

#### æ’åºä¸ç­›é€‰
```javascript
// æ’åºç»´åº¦
â”œâ”€â”€ updatedAt (é™åº)      // æœ€è¿‘æ›´æ–°
â”œâ”€â”€ createdAt (é™åº)      // æœ€è¿‘åˆ›å»º
â””â”€â”€ title (å­—æ¯åº)        // æ ‡é¢˜æ’åº

// ç­›é€‰é€»è¾‘
const filtered = filterReview 
  ? knowledgePoints.filter(kp => kp.reviewList) 
  : knowledgePoints;

// æ’åºå®ç°
const sorted = [...filtered].sort((a, b) => {
  if (sortBy === 'title') {
    return sortOrder === 'asc' 
      ? a.title.localeCompare(b.title) 
      : b.title.localeCompare(a.title);
  }
  return sortOrder === 'asc' ? dateA - dateB : dateB - dateA;
});
```

---

## 8. å®‰å…¨æœºåˆ¶

### 8.1 XSSé˜²æŠ¤

#### å¤šå±‚é˜²æŠ¤
```
é˜²æŠ¤å±‚æ¬¡
â”œâ”€â”€ 1. è¾“å…¥éªŒè¯
â”‚   â”œâ”€â”€ å‰ç«¯: è¡¨å•éªŒè¯/é•¿åº¦é™åˆ¶
â”‚   â””â”€â”€ åç«¯: SchemaéªŒè¯/ç±»å‹æ£€æŸ¥
â”œâ”€â”€ 2. å†…å®¹æ¸…ç†
â”‚   â”œâ”€â”€ DOMPurify: HTMLæ¸…ç†
â”‚   â””â”€â”€ rehype-sanitize: Markdownæ¸…ç†
â””â”€â”€ 3. CSPç­–ç•¥
    â””â”€â”€ Content-Security-Policyå¤´
```

#### DOMPurifyé…ç½®
```javascript
DOMPurify.sanitize(content, {
  ALLOWED_TAGS: [
    'p', 'br', 'strong', 'em', 'h1', 'h2', 
    'ul', 'ol', 'li', 'a', 'img'
  ],
  ALLOWED_ATTR: ['href', 'src', 'alt', 'title'],
  FORBID_TAGS: ['script', 'iframe', 'object'],
  FORBID_ATTR: ['onerror', 'onclick', 'onload']
});
```

### 8.2 å¯†ç å®‰å…¨
```javascript
// bcryptåŠ å¯†
const salt = await bcrypt.genSalt(10);
const hash = await bcrypt.hash(password, salt);

// éªŒè¯
const isMatch = await bcrypt.compare(input, hash);
```

---

## 9. éƒ¨ç½²ä¸é…ç½®

### 9.1 ç¯å¢ƒå˜é‡

#### åç«¯ (.env)
```bash
PORT=3000
MONGO_URI=mongodb://localhost:27017/feynman-platform
JWT_SECRET=your-secret-key
JWT_EXPIRES_IN=24h
BAIDU_APP_ID=your-app-id
BAIDU_API_KEY=your-api-key
BAIDU_SECRET_KEY=your-secret-key
WHISPER_API_URL=http://localhost:5001
```

#### å‰ç«¯ (.env)
```bash
VITE_API_BASE_URL=http://localhost:3000/api
VITE_ENABLE_WHISPER=true
```

### 9.2 ç”Ÿäº§éƒ¨ç½²

#### Nginxé…ç½®
```nginx
server {
    listen 80;
    server_name yourdomain.com;
    root /var/www/feynman-platform;

    location / {
        try_files $uri $uri/ /index.html;
    }

    location /api {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
    }
}
```

#### PM2éƒ¨ç½²
```bash
pm2 start index.js --name feynman-backend
pm2 startup
pm2 save
```

---

## 10. æœªæ¥ä¼˜åŒ–æ–¹å‘

### 10.1 åŠŸèƒ½æ‰©å±•

| å·²å®ç° | è§„åˆ’ä¸­ | è¿œæœŸæ„¿æ™¯ |
|-------|--------|---------|
| çŸ¥è¯†ç‚¹CRUD | çŸ¥è¯†å›¾è°±å¯è§†åŒ– | ç¤¾åŒºå…±äº«çŸ¥è¯†åº“ |
| è¯­éŸ³è½¬å½•åŒå¼•æ“ | å®æ—¶è¯­éŸ³è¯†åˆ« | å¤šè¯­è¨€æ”¯æŒ |
| AIè¯„ä¼° | è¯­éŸ³å¯¹è¯å¼å­¦ä¹  | è‡ªé€‚åº”å­¦ä¹ è·¯å¾„ |
| å¤ä¹ æ ‡è®° | é—´éš”é‡å¤ç®—æ³•(SM2) | å­¦ä¹ æ•°æ®åˆ†æ |

### 10.2 æ€§èƒ½ä¼˜åŒ–

| ä¼˜åŒ–ç‚¹ | å½“å‰ | ç›®æ ‡ | æ–¹æ¡ˆ |
|-------|------|------|------|
| é¦–å±åŠ è½½ | 1-2s | <1s | ä»£ç åˆ†å‰²/CDN |
| APIå“åº” | 100-300ms | <100ms | Redisç¼“å­˜ |
| Whisperè½¬å½• | 0.8-2s | <0.5s | æ¨¡å‹é‡åŒ– |
| AIè¯„ä¼° | 5-10s | <3s | æµå¼è¾“å‡º |

---

## æ›´æ–°æ—¥å¿—

| ç‰ˆæœ¬ | æ—¥æœŸ | æ›´æ–°å†…å®¹ |
|------|------|---------|
| v1.0.0 | 2025-01-13 | âœ… å®Œæˆæ ¸å¿ƒåŠŸèƒ½ï¼šç”¨æˆ·è®¤è¯/çŸ¥è¯†ç‚¹ç®¡ç†/è¯­éŸ³è½¬å½•/AIè¯„ä¼°/å¤ä¹ ç®¡ç†/æ ‡é¢˜æµè§ˆ |

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0  
**æœ€åæ›´æ–°**: 2025-01-13  
**ä½œè€…**: è´¹æ›¼å­¦ä¹ å¹³å°å›¢é˜Ÿ
